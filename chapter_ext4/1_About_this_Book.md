# 1. 关于此书

本文件试图描述 `ext4` 文件系统的磁盘格式。相同的基本概念也适用于 `ext2/3` 文件系统，尽管它们不支持 `ext4` 的所有功能，并且某些字段的长度较短。

> 注意：这是一项正在进行中的工作，基于作者（djwong）在手动解析文件系统时所做的笔记。数据结构定义应与 `Linux 4.18` 和 `e2fsprogs-1.44` 版本保持一致。欢迎所有评论和更正，因为在新创建的示例文件系统中可能有大量的知识和细节尚未得到充分反映。

## 1.1. 许可证

本书根据GNU通用公共许可证第2版(GNU Public License, v2)的条款授权。

## 1.2. 术语

`ext4` 将存储设备划分为逻辑块数组，既减少了记录开销，又通过强制更大的传输大小来提高吞吐量。通常情况下，块大小为 `4KiB`（与 `x86` 上的页面大小和块层的默认块大小相同），尽管实际大小是按照 `2^(10 + sb.s_log_block_size)` 字节计算的。在本文档中，磁盘位置是以这些逻辑块为单位给出的，而不是原始 `LBA`，也不是 1024 字节的块。为了方便起见，在本文档的其余部分，逻辑块大小将被称为 `$block_size`。

> 注：LBA（Logical Block Addressing，逻辑块地址） 是一种用于存储设备（如硬盘和 SSD）的地址寻址方式。
>
> 表示文件系统中`8KB`所在的位置：
> + 如果用逻辑块来表示（逻辑块大小是4KB），超级块存储在逻辑块2中（因为2×4KB=8KB）。
> + 如果用LBA表示（假设每个扇区为512字节），超级块位置可能是扇区16（因为16×512B=8KB）。
> + 如果用1024字节块表示，超级块位置可能是块8（因为8×1KB=8KB）。

在预格式化文本块中引用时， `sb` 指的是超级块中的字段，而 `inode` 指的是 `inode` 表条目中的字段。

## 1.3. 其他参考资料

另请参阅 [https://www.nongnu.org/ext2-doc/](https://www.nongnu.org/ext2-doc/)，其中收集了大量关于 `ext2/3` 的信息。这里还有一个旧的参考资料：[http://wiki.osdev.org/Ext2](http://wiki.osdev.org/Ext2)